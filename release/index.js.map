{"version":3,"file":"index.js","sources":["../src/useFormikSideEffects.ts","../src/FormikSideEffects.tsx"],"sourcesContent":["import React from 'react';\r\nimport { FormikContext } from 'formik';\r\n\r\nexport type SideEffects<T> = (currentValues: T, previousValues: T) => T | null;\r\n\r\nexport type AsyncSideEffect<T> = { field: keyof T & string; value: any };\r\n\r\nexport type AsyncSideEffects<T> = (\r\n  currentValues: T,\r\n  previousValues: T\r\n) => Promise<AsyncSideEffect<T>[]>;\r\n\r\nasync function checkAsyncSideEffect<T>(\r\n  currentFormik: FormikContext<T>,\r\n  previousFormik: FormikContext<T>,\r\n  determineAsyncSideEffect: AsyncSideEffects<T>\r\n) {\r\n  const sideEffects = await determineAsyncSideEffect(\r\n    currentFormik.values,\r\n    previousFormik.values\r\n  );\r\nconsole.log(sideEffects)\r\n  if (sideEffects) {\r\n    sideEffects.forEach((sideEffect, index) => {\r\n      currentFormik.setFieldValue(\r\n        sideEffect.field,\r\n        sideEffect.value,\r\n        index === sideEffects.length - 1\r\n      );\r\n    });\r\n  }\r\n}\r\n\r\nexport const useFormikSideEffects = <T extends {}>(\r\n  currentFormik: FormikContext<T>,\r\n  determineSideEffect: SideEffects<T>,\r\n  determineAsyncSideEffect?: AsyncSideEffects<T>\r\n) => {\r\n  var previous = React.useRef(currentFormik);\r\n\r\n  React.useEffect(() => {\r\n    const previousFormik = previous.current;\r\n\r\n    if (previousFormik.values !== currentFormik.values) {\r\n      if (determineSideEffect) {\r\n        const sideEffect = determineSideEffect(\r\n          currentFormik.values,\r\n          previousFormik.values\r\n        );\r\n\r\n        if (sideEffect) {\r\n          currentFormik.setValues(sideEffect);\r\n        }\r\n      }\r\n\r\n      if (determineAsyncSideEffect) {\r\n        checkAsyncSideEffect(\r\n          currentFormik,\r\n          previousFormik,\r\n          determineAsyncSideEffect\r\n        );\r\n      }\r\n    }\r\n\r\n    previous.current = currentFormik;\r\n  }, [currentFormik, determineSideEffect, determineAsyncSideEffect]);\r\n};\r\n","import React from 'react';\r\nimport { FormikConsumer, FormikContext } from 'formik';\r\nimport {\r\n  useFormikSideEffects,\r\n  SideEffects,\r\n  AsyncSideEffects\r\n} from './useFormikSideEffects';\r\n\r\ntype FormikSideEffectProps<T> = {\r\n  determineSideEffects: SideEffects<T>;\r\n  determineAsyncSideEffect?: AsyncSideEffects<T>;\r\n};\r\n\r\nconst FormikSideEffectChild = <T extends {}>({\r\n  formik,\r\n  determineSideEffects,\r\n  determineAsyncSideEffect\r\n}: FormikSideEffectProps<T> & {\r\n  formik: FormikContext<T>;\r\n}) => {\r\n  useFormikSideEffects<T>(\r\n    formik,\r\n    determineSideEffects,\r\n    determineAsyncSideEffect\r\n  );\r\n\r\n  return null;\r\n};\r\n\r\nexport const FormikSideEffects = <T extends {}>({\r\n  determineSideEffects,\r\n  determineAsyncSideEffect\r\n}: FormikSideEffectProps<T>) => (\r\n  <FormikConsumer>\r\n    {formik => (\r\n      <FormikSideEffectChild\r\n        determineSideEffects={determineSideEffects}\r\n        determineAsyncSideEffect={determineAsyncSideEffect}\r\n        formik={formik}\r\n      />\r\n    )}\r\n  </FormikConsumer>\r\n);\r\n"],"names":["useFormikSideEffects","currentFormik","determineSideEffect","determineAsyncSideEffect","previous","React","useRef","useEffect","previousFormik","current","values","sideEffect","setValues","sideEffects","console","log","forEach","index","setFieldValue","field","value","length","checkAsyncSideEffect","FormikSideEffectChild","ref","FormikConsumer","formik","determineSideEffects"],"mappings":"gGAiCaA,WACXC,EACAC,EACAC,OAEIC,EAAWC,EAAMC,OAAOL,GAE5BI,EAAME,yBACEC,EAAiBJ,EAASK,WAE5BD,EAAeE,SAAWT,EAAcS,OAAQ,IAC9CR,EAAqB,KACjBS,EAAaT,EACjBD,EAAcS,OACdF,EAAeE,QAGbC,GACFV,EAAcW,UAAUD,GAIxBR,YA1CRF,EACAO,EACAL,uBAE0BA,EACxBF,EAAcS,OACdF,EAAeE,uBAFXG,GAIRC,QAAQC,IAAIF,GACNA,GACFA,EAAYG,iBAASL,EAAYM,GAC/BhB,EAAciB,cACZP,EAAWQ,MACXR,EAAWS,MACXH,IAAUJ,EAAYQ,OAAS,0CA6B/BC,CACErB,EACAO,EACAL,GAKNC,EAASK,QAAUR,GAClB,CAACA,EAAeC,EAAqBC,KCpDpCoB,WAAuCC,UAO3CxB,8DAMO,yCAGuCwB,oEAI9CnB,gBAACoB,+BACEC,UACCrB,gBAACkB,GACCI,qBAAsBA,EACtBxB,yBAA0BA,EAC1BuB,OAAQA"}